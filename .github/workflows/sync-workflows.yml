name: Sync Workflows

on:
  push:
    paths:
      - 'github-sync-workflows/sync_data.py'
      - 'github-sync-workflows/Data/**'
      - 'github-sync-workflows/sync_workflows.py'
  workflow_dispatch:
    inputs:
      mode:
        description: 'Run mode'
        required: true
        default: 'real'
        type: choice
        options:
          - dry-run
          - real

jobs:
  sync:
    name: Sync workflow files to target repos
    runs-on: ubuntu-latest

    steps:
      - name: 🛎️ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 🐍 Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: 📦 Install dependencies
        run: pip install requests

      - name: 🚀 Run Sync Workflows
        env:
          PAT_OVERLORDZORN: ${{ secrets.PAT_OVERLORDZORN }}
          PAT_CVO_ORG: ${{ secrets.PAT_CVO_ORG }}
        run: |
          MODE="${{ github.event.inputs.mode || 'real' }}"
          echo "====================================="
          echo " Running Sync Workflows in $MODE mode "
          echo "====================================="
          echo
          python github-sync-workflows/sync_workflows.py "$MODE"

      - name: ✅ Post-run summary
        if: success() || failure()
        run: |
          echo "### 🧩 Sync Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Run mode: **${{ github.event.inputs.mode || 'real' }}**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Review the logs above for details." >> $GITHUB_STEP_SUMMARY
